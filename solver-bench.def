Bootstrap: docker
From: debian:testing-slim

%environment
    export LC_ALL=C
    export LANG=C
    export PATH=/usr/local/bin:$PATH

%post
    set -euo pipefail
    apt-get update
    apt-get install -y --no-install-recommends \
        python3 python3-pip default-jre-headless libgmp10 ca-certificates \
        && rm -rf /var/lib/apt/lists/*

    # benchexec
    pip3 install --no-cache-dir --break-system-packages benchexec

    chmod 0755 /usr/local/bin/cvc5 /usr/local/bin/z3-noodler
    chmod 0644 /usr/local/bin/ostrich.jar /usr/local/bin/bass.jar
    printf '#!/bin/bash\nexec java -jar /usr/local/bin/ostrich.jar -portfolio=strings +quiet "$@"\n' >/usr/local/bin/ostrich
    chmod +x /usr/local/bin/ostrich
    printf '#!/bin/bash\nexec java -jar /usr/local/bin/bass.jar edu.boisestate.cs.SolveMain -v 2 -s inverse "$@"\n' >/usr/local/bin/bass
    chmod +x /usr/local/bin/bass

%files
    #tool executables
    bin/cvc5 /usr/local/bin/cvc5
    bin/z3-noodler /usr/local/bin/z3-noodler
    bin/ostrich.jar /usr/local/bin/ostrich.jar
    bin/bass.jar /usr/local/bin/bass.jar

    #tool scripts for benchexec
    util/benchexec/bass.py /usr/local/lib/python3.13/dist-packages/benchexec/tools/bass.py
    util/benchexec/cvc5.py /usr/local/lib/python3.13/dist-packages/benchexec/tools/cvc5.py
    util/benchexec/z3-noodler.py /usr/local/lib/python3.13/dist-packages/benchexec/tools/z3-noodler.py
    util/benchexec/ostrich.py /usr/local/lib/python3.13/dist-packages/benchexec/tools/ostrich.py

%labels
    Author="Nat Steven"
    Tooling="BenchExec+Solvers"